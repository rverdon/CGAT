% Paper for the ChouchBase assignment.

\documentclass[]{IEEEtran}

\usepackage{float}
\usepackage{url}
\usepackage{graphicx}
\usepackage{color}

\begin{document}

\title{No Dogs On The Couch$_{Base}$}

% author names and affiliations
% use a multiple column layout for up to two different
% affiliations

\author{\IEEEauthorblockN{Eriq Augustine, Ryan Hnarkis, Aldrin Montana, Ryan Verdon, Tyler Yero}
\\
\IEEEauthorblockA{Department of Computer Science\\
Cal Poly, San Luis Obispo\\
 \textsf{\{eaugusti, rhnaraki, amontana, rverdon, tyero\}@calpoly.edu}
}
}

\maketitle

\thispagestyle{empty}
\pagestyle{empty}

\section{Introduction}
Our team decided to compare a MySQL cluster versus a Couchbase cluster for running a
web application. We are using an eight table SQL schema from Ryan Verdon's Thesis plus an addition testing table. To evaluate
the performance we auto-generated around 400MB of data and inserted the same data into each cluster.
Obviously using a different data model for Couchbase to accommodate for the fact it is a NoSQL key-value store
instead of a relational database. We then created a set of six experiments to run. Five came from common 
use cases found in the web application. While the other was designed to test the performance on each cluster
of repeatedly writing and reading from the same object. Our major metrics are write performance, read performance,
and time-delay between writes and reads of the same data. The rest of the paper is broken down as follows.
Section 2 describes in depth how we designed the experiment. Section 3 discusses the workloads we ran on each system. Section 4 describes our implementation. Section 5 goes
into the results of each of our experiments and some analysis on the data we obtained. Lastly, section 6 presents 
our conclusions.

\section{Experiment Design}
For our experiments we are using a total of five EC2 instances from the Amazon Web Services cloud. For both of our systems four servers were used for the database while the last was used for running our workload harness. The MySQL system is setup with one master server for writes and three slaves servers that replicate all of the masters data. Unlike the Couchbase system where each server handled a subset of the data.

Our major driving force of this experiment was to see how Couchbase compared to MySQL for running a web application. To test which is better we created a workload harness. The main tasks of the workload harness was to define how many times a workload would run and which workloads to run. In our case workloads define a certain task. For example, getting of the data necessary to display a users profile. In our system a workload knows how to do its job in both MySQL and the Couchbase API. We leave describing each type workload we ran to the next section.

As each workload is run the workload harness records important stats. Some of the stats include how long the workload took to run, the min and max times of an individual query or insertion, and the standard deviations of individual runs.

\subsection{Data}
The data we are storing comes from Ryan Verdon's masters thesis. It is the backend for a community genome annotation database. It contains data like genome sequences, genes, and species information. The representation of the data is vastly different in the two systems. 

But there exists four main pieces of data that are crucial to either representation. They are contigs, annotations, users, and groups. Contigs are what a biologist annotates to find genes. The main portion of a contig is a DNA sequence. Annotations are the record or formal representation of a gene that has been found in a specific contig. An annotation has several parts including coordinates in the contig which specify individual exons and meta information about the annotation like who uploaded it and when it was done, etc. 

Groups are another important part of the usefulness of the system. Users of like minds can join the same group to receive important information. Users is a major part of the data and is one of the central pillars that connects the data. Users upload contigs, create annotations, and join groups. Below we show the different ways we store the data in SQL and JSON.

\subsubsection{SQL}
In SQL the data is represented as nine tables. A diagram of the tables with links to represent foreign key constraints is shown in Figure 1. 

\subsubsection{JSON}
For Couchbase we used four JSON objects which are shown in Figures 2-5. We left out the JSON object for the test table. It just consisted of two fields (Id and Name). All of the information from the SQL tables is represented in these JSON objects. We take advantage of nested objects to reduce as much subsequent requerying of the database as possible.

\begin{figure}%
	\includegraphics[width=5.5in]{SQLDiagram.png}%
	\caption{The SQL diagram for CGAT.}
	\label{fig:SQLDiagram}
\end{figure}%

\clearpage

\begin{figure}%
	\includegraphics[height=90mm,width=100mm]{user.png}
	\caption{The JSON for a user.}
	\label{fig:JSON-user}
\end{figure}%

\begin{figure}%
	\includegraphics[height=70mm]{contig.png}
	\caption{The JSON for a contig.}
	\label{fig:JSON-contig}
\end{figure}%

\begin{figure}%
	\includegraphics[height=100mm]{annotation.png}
	\caption{The JSON for an annotation.}
	\label{fig:JSON-annotation}
\end{figure}%

\begin{figure}%
	\includegraphics[height=20mm]{group.png}
	\caption{The JSON for a group.}
	\label{fig:JSON-group}
\end{figure}%

\clearpage

\section{Workloads}
The following workloads were ran on both the MySQL and Couchbase clusters.

\subsection{Assigning a Task}
This workload comes from a use-case in the web application. The main idea is that a new contig has been uploaded and some users that care about this contig need to be notified. 

\subsection{Profiling}
The profiling workload simulates what happens when all of the information about a user is gathered. This includes: all groups they are a member of, all full and partial annotations they have submitted, and all tasks they have assigned. This is a read-heavy workload.

\subsection{Publishing}
This workload involves updating a user's experience because of a completed annotation. The corresponding annotation record must also be set to complete, have its finished date updated, and have its gained experience set. This is a write-heavy workload.

\subsection{Adding and Removing Group Membership}
Adding or removing users to a group is a task common for classroom situations. In MySQL, this operation requires a join between three tables: Groups, Users, and GroupMembership. In Couchbase, this requires retrieving the key for the desired group and removing the user from the members field. This is a mixed workload involving reading and writing.

\subsection{Uploading Contigs}
This workload represents a contig being inserted into the database. All of the attributes of a contig are set, including the user who uploaded it and its sequence. This is a write-heavy workload.

\subsection{Read and Writing Performance}
This is a test workload to examine the performance of writing and reading from the same object in succession. We are interested in the differences in performance of the two systems.

\section{Implementation}
Our experiment was implemented completely in Java. To do the MySQL portion of the workload we used
the MySQL JDBC driver. For the Couchbase portion we used the Couchbase Java library from their website.

\section{Evaluation}
In this section we discuss the results from each workload in turn.

%section on each workload and the results on each system (could be a table tbh and not a graph)
%probably some weak analysis on why we expected the results
%need to ask eriq the # of times each workload was  run, might be in an email?

\subsection{Assigning a Task}

\subsection{Profiling}

\subsection{Publishing}

\subsection{Adding and Removing Group Membership}

\subsection{Uploading Contigs}

\subsection{Read and Writing Performance}

\section{Conclusions}
TODO

% TODO: Uncomment if we use any refs
% \bibliographystyle{acm}
% \bibliography{refs}

\end{document}
